kind: Module
description: Node Proxy
name: nodeproxy
type: container

services:
  - name: nodeproxy
    args: [npm, run, start]
    devMode:
      sync:
        - target: /app
          source: app
          mode: one-way-replica
    ports:
      - name: http
        containerPort: 5000
    healthCheck:
      httpGet:
        path: /health
        port: http
    ingresses:
      - path: /
        port: http
        hostname: nodeproxy.${var.baseHostname}
    env:
      HOSTNAME: nodeproxy.${var.baseHostname}
      VMBUCKET_URL: vmbucket.${var.baseHostname}
      POSTGRES_DB:
        secretRef:
          name: postgres
          key: dbname
      POSTGRES_PASSWORD:
        secretRef:
          name: postgres
          key: password
      POSTGRES_USER:
        secretRef:
          name: postgres
          key: username
    dependencies:
      - vmbucket
      - db
