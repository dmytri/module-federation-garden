kind: Module
description: Postgres container
type: container
name: postgres
image: postgres:15.2-alpine3.17
services:
  - name: db
    volumes:
      - name: data
        containerPath: /db-data
    ports:
      - name: db
        containerPort: 5432
    env:
      POSTGRES_DB:
        secretRef:
          name: postgres
          key: dbname
      POSTGRES_PASSWORD:
        secretRef:
          name: postgres
          key: password
      POSTGRES_USER:
        secretRef:
          name: postgres
          key: username
    healthCheck:
      command:
        - /bin/sh
        - -c
        - 'env PGPASSWORD="$POSTGRES_PASSWORD" psql -w -U "$POSTGRES_USER" -d "$POSTGRES_DB" -c ''SELECT 1'''
